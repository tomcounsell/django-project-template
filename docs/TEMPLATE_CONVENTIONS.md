# Template Conventions

This document outlines the conventions and best practices for Django templates in this project. Following these guidelines ensures consistency and maintainability across the frontend codebase.

## Directory Structure

Templates are organized in two primary locations:

- `/templates`: Global templates used across multiple apps
- `/apps/public/templates`: Public frontend templates (being migrated to `/templates`)

All new templates should be placed in the root `/templates` directory, not in app-specific directories.

## Template Types

### Base Templates

- `_base.html`: Foundation template for full HTML pages
- `_partial.html`: Base template for HTMX partial updates (no `<html>`, `<head>`, or `<body>` tags)
- `_base_new.html`: Enhanced base template for newer pages (transitional)

### Layout Components

- `layout/footer.html`: Global footer component
- `layout/navbar.html`: Global navigation bar
- `nav/account_menu.html`: User account menu component

### Content Templates

- `pages/*.html`: Full page templates for main content areas
- `components/*.html`: Reusable UI components for HTMX interactions
- `messages/toast.html`: Toast notifications for user feedback

## Template Pattern

The project uses standard Django templates with the following patterns:

### 1. Template Inheritance

Base templates define common layout and blocks that are extended by page templates:

```html
{% extends "_base.html" %}

{% block content %}
  <!-- Page-specific content here -->
{% endblock %}
```

Common blocks include:
- `title`: Page title
- `meta`: Meta tags for SEO
- `extra_css`: Page-specific CSS
- `content`: Main page content
- `scripts`: Page-specific JavaScript

### 2. Template Includes

Reusable UI elements are created as separate template files and included using the include tag:

```html
{% include "nav/navbar.html" %}
{% include "layout/footer.html" %}
```

For dynamic components, context variables can be passed:

```html
{% include "components/card.html" with title="Dashboard" description=description %}
```

### 3. Context Processors

Custom context data for templates is generated by functions in `apps/public/views/components/`. This data is automatically available in all templates.

### 4. HTMX Integration

HTMX is used for interactive elements, with partial updates handled by dedicated views:

```html
<button 
  hx-get="/team/{{ team.id }}/members/" 
  hx-target="#member-list"
  hx-swap="innerHTML">
  Load Members
</button>

<div id="member-list"></div>
```

For out-of-band (OOB) updates, use the `hx-swap-oob` attribute:

```html
<div id="notifications" hx-swap-oob="true">
  {% include "messages/toast.html" %}
</div>
```

## Naming Conventions

- **Files**: Use lowercase with underscores for filenames (e.g., `user_profile.html`, `team_list.html`)
- **Templates in apps**: Should follow the format `{app_name}/{feature}/{name}.html`
- **CSS Classes**: Use kebab-case (e.g., `user-card`, `nav-item`)
- **HTML IDs**: Use snake_case (e.g., `user_profile`, `team_list`)
- **Block Names**: Use lowercase with underscores (e.g., `{% block page_content %}`)

## CSS & Styling

- Use Tailwind CSS for styling instead of custom CSS where possible
- Organize Tailwind classes in a consistent order (layout → typography → colors → effects)
- Avoid inline styles unless absolutely necessary
- For complex components, consider extracting common class combinations using Tailwind's `@apply`

## JavaScript

- Avoid adding `<script>` tags to templates unless absolutely necessary
- Prefer HTMX for interactive functionality over custom JavaScript
- Use Alpine.js for simple interactive components when necessary
- When JavaScript is required, prefer event attributes `hx-on:*` or `x-on:*` for HTMX/Alpine.js

## Best Practices

### 1. Progressive Enhancement

Design templates to work without JavaScript first, then enhance with HTMX and other frontend technologies.

### 2. Partial Templates

When creating HTMX-enabled components:
- Use `_partial.html` as the base template
- Set `is_oob` context variable for out-of-band updates
- Include only the HTML needed for the specific component

### 3. Template Comments

Use Django template comments to document complex sections or blocks:

```html
{# User profile section with editable fields #}
```

### 4. Template Tags & Filters

Create custom template tags and filters for complex rendering logic rather than embedding it in templates.

### 5. Accessibility

- Always include proper ARIA attributes for interactive elements
- Ensure color contrast meets WCAG standards
- Use semantic HTML elements appropriately

### 6. Performance

- Minimize template nesting to reduce rendering time
- Use template fragment caching for expensive components
- When including large lists, consider pagination or lazy loading

## Example Templates

### Page Template

```html
{% extends "_base.html" %}

{% block title %}Team Dashboard{% endblock %}

{% block content %}
<div class="container mx-auto py-6">
  <h1 class="text-2xl font-bold mb-4">{{ team.name }} Dashboard</h1>
  
  <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
    {% include "components/team_stats.html" with team=team %}
    
    <div id="team_members">
      {% include "components/team_members_list.html" with members=members %}
    </div>
    
    <button
      hx-get="{% url 'team:refresh_stats' team.id %}"
      hx-target="#team_members"
      class="btn btn-primary">
      Refresh
    </button>
  </div>
</div>
{% endblock %}
```

### HTMX Component

```html
{# components/team_members_list.html #}
<div id="team_members_list" class="bg-white rounded shadow p-4">
  <h2 class="text-lg font-semibold mb-2">Team Members</h2>
  
  <ul class="divide-y">
    {% for member in members %}
    <li class="py-2">
      <div class="flex items-center justify-between">
        <span>{{ member.name }}</span>
        <span class="badge badge-{{ member.role }}">{{ member.get_role_display }}</span>
      </div>
    </li>
    {% empty %}
    <li class="py-2 text-gray-500">No members found.</li>
    {% endfor %}
  </ul>
</div>
```

## Testing Templates

- Test templates with Django's `assertTemplateUsed` and `assertContains`
- Validate HTML output for accessibility and correctness
- Test HTMX interactions with proper request headers

## Related Documentation

- [VIEW_CONVENTIONS.md](VIEW_CONVENTIONS.md): Conventions for Django views that render templates
- [HTMX Documentation](https://htmx.org/docs/): Official HTMX documentation
- [Tailwind CSS](https://tailwindcss.com/docs): Tailwind CSS documentation