{% extends "base.html" %}
{% load static %}

{% comment %}
  Account Settings Page
  ====================
  
  Purpose:
  Allows users to manage their account settings, including personal information
  and password changes. This page is accessible only to authenticated users.
  
  Section 1: Basic Information
  - First Name: User's first name
  - Last Name: User's last name
  - Email: User's email address (also serves as username)
  - Save button: Updates the user's basic information
  
  Section 2: Password Management
  - Current password: Verification of existing password
  - New password: Field for entering a new password
  - Confirm password: Verification field to prevent typos
  - Update password button: Changes the user's password
  - Error display: Shows password-related errors (mismatch, invalid format, etc.)
  
  User Experience:
  - Segmented interface with clear section headers
  - Validation feedback for form fields
  - Separate submission buttons for each section to prevent unintended changes
  - Clear error messaging for validation issues
  
  Integration:
  Displays in the main content area of the base template, providing
  access to account management functionality in a clean, organized interface.
{% endcomment %}

{% block title %}Account Settings{% endblock %}

{% block main_header %}
  <h1 class="text-3xl font-bold tracking-tight text-navy-600">Account Settings</h1>
{% endblock %}

{% block content %}
  <!-- Basic Information Section -->
  <div class="bg-white shadow-xs rounded-sm mb-8">
    <div class="p-6">
      <h2 class="text-xl font-semibold text-gray-900 mb-4">
        Basic Information
      </h2>
      <form method="post" class="space-y-6">
        {% csrf_token %}
        <div class="grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-6">
          <!-- First Name -->
          <div class="sm:col-span-3">
            <label for="id_first_name" class="block text-sm font-medium text-gray-700">
              First Name
            </label>
            <div class="mt-1">
              <input type="text" name="first_name" id="id_first_name" value="{{ user_form.first_name.value|default:'' }}" 
                class="block w-full rounded-sm border-gray-300 shadow-xs focus:border-navy-700 focus:ring-navy-700 sm:text-sm" />
            </div>
          </div>

          <!-- Last Name -->
          <div class="sm:col-span-3">
            <label for="id_last_name" class="block text-sm font-medium text-gray-700">
              Last Name
            </label>
            <div class="mt-1">
              <input type="text" name="last_name" id="id_last_name" value="{{ user_form.last_name.value|default:'' }}" 
                class="block w-full rounded-sm border-gray-300 shadow-xs focus:border-navy-700 focus:ring-navy-700 sm:text-sm" />
            </div>
          </div>

          <!-- Email -->
          <div class="sm:col-span-6">
            <label for="id_email" class="block text-sm font-medium text-gray-700">
              Email
            </label>
            <div class="mt-1">
              <input type="email" name="email" id="id_email" value="{{ user_form.email.value|default:'' }}" 
                class="block w-full rounded-sm border-gray-300 shadow-xs focus:border-navy-700 focus:ring-navy-700 sm:text-sm" />
            </div>
          </div>
        </div>

        <div class="pt-4">
          <button type="submit" name="update_info" class="inline-flex justify-center py-2 px-4 border border-transparent shadow-xs text-sm font-medium rounded-sm text-white bg-navy-900 hover:bg-navy-800 focus:outline-hidden focus:ring-2 focus:ring-offset-2 focus:ring-navy-700">
            Save Changes
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Password Change Section -->
  <div class="bg-white shadow-xs rounded-sm">
    <div class="p-6">
      <h2 class="text-xl font-semibold text-gray-900 mb-4">
        Change Password
      </h2>

      <form method="post" class="space-y-6">
        {% csrf_token %}
        
        <!-- Current Password -->
        <div>
          <label for="id_old_password" class="block text-sm font-medium text-gray-700">
            Current Password
          </label>
          <div class="mt-1">
            <input type="password" name="old_password" id="id_old_password" 
              class="block w-full rounded-sm border-gray-300 shadow-xs focus:border-navy-700 focus:ring-navy-700 sm:text-sm" />
          </div>
          {% if password_form.old_password.errors %}
            <p class="mt-2 text-sm text-red-600">{{ password_form.old_password.errors.0 }}</p>
          {% endif %}
        </div>

        <!-- New Password -->
        <div>
          <label for="id_new_password1" class="block text-sm font-medium text-gray-700">
            New Password
          </label>
          <div class="mt-1">
            <input type="password" name="new_password1" id="id_new_password1" 
              class="block w-full rounded-sm border-gray-300 shadow-xs focus:border-navy-700 focus:ring-navy-700 sm:text-sm" />
          </div>
          {% if password_form.new_password1.errors %}
            <p class="mt-2 text-sm text-red-600">{{ password_form.new_password1.errors.0 }}</p>
          {% endif %}
        </div>

        <!-- Confirm Password -->
        <div>
          <label for="id_new_password2" class="block text-sm font-medium text-gray-700">
            Confirm New Password
          </label>
          <div class="mt-1">
            <input type="password" name="new_password2" id="id_new_password2" 
              class="block w-full rounded-sm border-gray-300 shadow-xs focus:border-navy-700 focus:ring-navy-700 sm:text-sm" />
          </div>
          {% if password_form.new_password2.errors %}
            <p class="mt-2 text-sm text-red-600">{{ password_form.new_password2.errors.0 }}</p>
          {% endif %}
        </div>

        <div class="pt-4">
          <button type="submit" name="update_password" class="inline-flex justify-center py-2 px-4 border border-transparent shadow-xs text-sm font-medium rounded-sm text-white bg-navy-900 hover:bg-navy-800 focus:outline-hidden focus:ring-2 focus:ring-offset-2 focus:ring-navy-700">
            Update Password
          </button>
        </div>
      </form>

      <!-- Password Form Errors -->
      {% if password_form.errors %}
        <div class="mt-6 p-4 border border-red-200 bg-red-50 rounded-sm">
          {% for error in password_form.non_field_errors %}
            <p class="text-sm text-red-600">{{ error|escape }}</p>
          {% endfor %}
        </div>
      {% endif %}
    </div>
  </div>

  <!-- Help Section -->
  <div class="mt-8 bg-gray-50 rounded-sm p-6">
    <p class="text-gray-600">
      Need help? <a href="#" class="font-medium text-navy-700 hover:text-navy-900">Contact support</a>
    </p>
  </div>
{% endblock content %}